<?xml version="1.0" encoding="utf-8" ?>
<ContentPage xmlns="http://xamarin.com/schemas/2014/forms"
             xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
             x:Class="Siren.Views.MainPage"
             xmlns:vm="clr-namespace:Siren.ViewModels" 
             xmlns:views="clr-namespace:Siren.Views"
             xmlns:icons="clr-namespace:Siren.Assets"
             Title="{Binding Title}"
             BackgroundColor="{StaticResource Dark}">

    <ContentPage.BindingContext>
        <vm:MainViewModel />
    </ContentPage.BindingContext>

    <Grid RowDefinitions="auto,auto,*,*,auto" ColumnDefinitions="320,*" ColumnSpacing="0" RowSpacing="0">

        <Grid Grid.Row="0" Grid.Column="0" BackgroundColor="{StaticResource VeryDark}">
            <Button Text="Add Setting" Command="{Binding AddSettingCommand}" HorizontalOptions="Start" Margin="10"/>
        </Grid>

        <Grid Grid.Row="0" Grid.Column="1" BackgroundColor="{StaticResource VeryDark}">
            <Button Text="Add Scene" Command="{Binding AddSceneCommand}" HorizontalOptions="Start" Margin="10"/>
        </Grid>
        
        <Grid Grid.Row="1" Grid.RowSpan="3" Grid.Column="0" BackgroundColor="{StaticResource Dark}" >
            <ScrollView Orientation="Vertical" VerticalScrollBarVisibility="Always">
                <StackLayout x:Name="SettingsList" Grid.Row="0" BindableLayout.ItemsSource="{Binding Settings}" Spacing="0">
                    <BindableLayout.ItemTemplate>
                        <DataTemplate>
                            <views:SettingCardView>
                                <views:SettingCardView.GestureRecognizers>
                                    <TapGestureRecognizer Command="{Binding BindingContext.SelectSettingCommand,Source={x:Reference SettingsList}}" 
                                                          CommandParameter="{Binding Name}"/>
                                </views:SettingCardView.GestureRecognizers>
                            </views:SettingCardView>
                        </DataTemplate>
                    </BindableLayout.ItemTemplate>
                </StackLayout>
            </ScrollView>
        </Grid>

        <Grid Grid.Row="1" Grid.Column="1" HeightRequest="100" BackgroundColor="{StaticResource Medium}">
            <ScrollView Orientation="Horizontal" HorizontalScrollBarVisibility="Always" Grid.Row="0" Grid.Column="0">
                <StackLayout x:Name="ScenesList" Grid.Row="0" BindableLayout.ItemsSource="{Binding SelectedSetting.Scenes}" Orientation="Horizontal" Spacing="0">
                    <BindableLayout.ItemTemplate>
                        <DataTemplate>
                            <views:SceneCardView>
                                <views:SceneCardView.GestureRecognizers>
                                    <TapGestureRecognizer Command="{Binding BindingContext.SelectSceneCommand,Source={x:Reference ScenesList}}" 
                                                          CommandParameter="{Binding Name}"/>
                                </views:SceneCardView.GestureRecognizers>
                            </views:SceneCardView>
                        </DataTemplate>
                    </BindableLayout.ItemTemplate>
                </StackLayout>
            </ScrollView>
        </Grid>

        <Grid Grid.Row="2" Grid.Column="1" RowDefinitions="auto,*" BackgroundColor="{StaticResource Medium}">
            <Grid BackgroundColor="{StaticResource Dark}">
                <StackLayout Grid.Row="0" Orientation="Horizontal" Margin="10">
                    <Button Text="Add Elements" Command="{Binding AddElementsCommand}"/>
                    <Button FontFamily="FA" Text="{x:Static icons:FAFont.FloppyDisk}" Command="{Binding SaveSceneCommand}"/>
                </StackLayout>
            </Grid>
            <ScrollView Grid.Row="1">
                <FlexLayout x:Name="ElementsList" 
                            BindableLayout.ItemsSource="{Binding SelectedSetting.Elements}" 
                            Wrap="Wrap" 
                            Direction="Row" 
                            JustifyContent="Start"
                            AlignContent="Start"
                            AlignItems="Start"
                            Padding="5">
                    <BindableLayout.ItemTemplate>
                        <DataTemplate>
                            <views:ElementPlayerView/>
                        </DataTemplate>
                    </BindableLayout.ItemTemplate>
                </FlexLayout>
            </ScrollView>
        </Grid>

        <Grid Grid.Row="3" Grid.Column="1" RowDefinitions="auto,*" BackgroundColor="{StaticResource Medium}">
            <Grid BackgroundColor="{StaticResource Dark}">
                <StackLayout Orientation="Horizontal" Margin="10">
                    <Button Text="Add Effects" Command="{Binding AddEffectsCommand}"/>
                </StackLayout>
            </Grid>
            <ScrollView Grid.Row="1">
                <FlexLayout x:Name="EffectsList" 
                        BindableLayout.ItemsSource="{Binding SelectedSetting.Effects}" 
                        Wrap="Wrap" 
                        Direction="Row" 
                        JustifyContent="Start"
                        AlignContent="Start"
                        AlignItems="Start"
                        Padding="5">
                    <BindableLayout.ItemTemplate>
                        <DataTemplate>
                            <views:EffectPlayerView/>
                        </DataTemplate>
                    </BindableLayout.ItemTemplate>
                </FlexLayout>
            </ScrollView>
        </Grid>

        <Grid Grid.Row="4" BackgroundColor="{StaticResource VeryDark}" Grid.ColumnSpan="2">
            <Button FontFamily="FA" Text="{x:Static icons:FAFont.CirclePlay}" FontSize="32"
                    Command="{Binding GlobalPlayCommand}"
                    BackgroundColor="LightGreen"
                    Margin="10"
                    WidthRequest="120"
                    HeightRequest="50"
                    CornerRadius="15"
                    HorizontalOptions="Center">
                <Button.Triggers>
                    <DataTrigger TargetType="Button" Binding="{Binding IsScenePlaying}" Value="True">
                        <Setter Property="Text" Value="{x:Static icons:FAFont.CircleStop}"/>
                        <Setter Property="BackgroundColor" Value="Pink"/>
                    </DataTrigger>
                </Button.Triggers>
            </Button>
        </Grid>
    </Grid>

</ContentPage>
